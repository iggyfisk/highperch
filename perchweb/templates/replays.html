{% import "races.html" as racemacros %}

{% macro card(replay) %}
<div class="replay card">
    <div class="minimap"><img src="{{replay['Map']|mapthumbnail}}" title="{{ replay['Map'] }}" /></div>
    <div class="details">
        <div class="header">
            <a class="title" href="{{ url_for('views.view_replay', replay_id=replay['ID']) }}">{{ replay['Name'] }}</a>
        </div>
        <p>{{ replay['Length']|gametime }} | {{ replay['GameType'] }} | {{ replay['Map'] }} | {{ replay['TowerCount'] }} towers | {{ replay.upload_date() }}</p>
        {{ teams(replay.teams()) }}
    </div>
    <a class="download" href="/download/replay">
        <i class="icon-download-alt"></i>
    </a>
</div>
{% endmacro %}

{% macro teams(teams, detailed=False, winnerId=None) %}
    <div class="teams">
        {% for (teamId, players) in teams.items() %}            
            <div class="team">
                {% if detailed %}
                <h2>
                        Team {{ teamId }}
                        {% if teamId == winnerId %}
                        <b>Winner!</b>
                        {% elif winnerId is not none %}
                        <b>Loser!</b>
                        {% endif %}
                    </u>
                </h2>
                {% endif %}
            {% for player in players %}
                <div class="player">
                    <div class="icon-name">
                        {{ racemacros.icon(player['race'], player['raceDetected']) }}<a href="{{ url_for('views.view_player', battletag=player['name']) }}">{{ player['name']|displayname }}</a> 
                    </div>
                    {% if detailed %}
                    <div class="details">
                        {{ player['apm'] }} APM <!-- |
                        Actions |
                        Build order |
                        Units |
                        Buildings |
                        Heroes |
                        Items -->
                    </div>
                {% endif %}
                </div>
            {% endfor %}
            </div>
        {% if not loop.last %}<div class="vs">vs</div>{% endif %}
        {% endfor %}
    </div>
{% endmacro %}
{% import "races.html" as racemacros %}

{% macro card(replay) %}
<div class="replay card">
    <div class="minimap"><img src="{{replay['Map']|mapthumbnail}}" title="{{ replay['Map'] }}" /></div>
    <div class="details">
        <div class="header">
            <a class="title" href="{{ url_for('views.view_replay', replay_id=replay['ID']) }}">{{ replay['Name'] }}</a>
        </div>
        <p>{{ replay['Length']|gametime }} | {{ replay['GameType'] }} | {{ replay['Map'] }} | {{ replay['TowerCount'] }} towers | {{ replay.upload_date() }}</p>
        {{ teams(replay) }}
    </div>
    <a class="download" href="/static/replays/{{ replay['ID'] }}.w3g">
        <i class="icon-download-alt"></i>
    </a>
</div>
{% endmacro %}

{% macro teams(replay, detailed=False) %}
    <div class="teams">
        {% for (teamId, players) in replay.teams().items() %}            
            <div class="team">
                {% if detailed %}
                <h2>
                    Team {{ teamId }}
                    {% if teamId == replay['winningTeamId'] %}
                    
                        <b>Winner{% if not replay['winningTeamConfirmed'] %}?{% else %}!{% endif %}</b>
                    {% elif winnerId is not none %}
                        <b>Loser{% if not replay['winningTeamConfirmed'] %}?{% else %}!{% endif %}</b>
                    {% endif %}
                </h2>
                {% endif %}
            {% for player in players %}
                <div class="player">
                    {% if detailed %}
                        <div class="icon-name">
                            {{ racemacros.icon(player['race'], player['raceDetected']) }}<a class="playername" style="color:{{ replay.player_colors[player['id']] }}" href="{{ url_for('views.view_player', battletag=player['name']) }}">{{ player['name']|displayname }}</a> 
                        </div>
                            <div class="details">
                            {{ player['apm'] }} APM <!-- |
                            Actions |
                            Build order |
                            Units |
                            Buildings |
                            Heroes |
                            Items -->
                        </div>
                    {% else %}
                        <div class="icon-name">
                            {{ racemacros.icon(player['race'], player['raceDetected']) }}<a class="playername" href="{{ url_for('views.view_player', battletag=player['name']) }}">{{ player['name']|displayname }}</a> 
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
            </div>
        {% if not loop.last %}<div class="vs">vs</div>{% endif %}
        {% endfor %}
    </div>
{% endmacro %}